const I=t;(function(s,H){const R=t,n=s();while(!![]){try{const S=-parseInt(R(0x1b1))/0x1*(-parseInt(R(0x1ce))/0x2)+-parseInt(R(0x1cc))/0x3*(-parseInt(R(0x1ba))/0x4)+-parseInt(R(0x1c4))/0x5*(parseInt(R(0x1cf))/0x6)+parseInt(R(0x1b2))/0x7+-parseInt(R(0x1c0))/0x8*(parseInt(R(0x1c6))/0x9)+parseInt(R(0x191))/0xa+parseInt(R(0x1ae))/0xb*(-parseInt(R(0x1ca))/0xc);if(S===H)break;else n['push'](n['shift']());}catch(u){n['push'](n['shift']());}}}(A,0x9e814));function t(s,H){const n=A();return t=function(S,u){S=S-0x179;let V=n[S];return V;},t(s,H);}import{connect}from'cloudflare:sockets';let userID=I(0x192),proxyIP='';if(!isValidUUID(userID))throw new Error('uuid\x20is\x20not\x20valid');export default{async 'fetch'(s,H,n){const l=I;try{userID=H[l(0x198)]||userID,proxyIP=H[l(0x180)]||proxyIP;const S=s[l(0x17a)][l(0x196)](l(0x1bd));if(!S||S!==l(0x1af)){const u=new URL(s['url']);switch(u[l(0x1a6)]){case'/':return new Response(JSON[l(0x19e)](s['cf']),{'status':0xc8});case'/'+userID:{const V=getVLESSConfig(userID,s['headers']['get'](l(0x17c)));return new Response(''+V,{'status':0xc8,'headers':{'Content-Type':l(0x182)}});}default:return new Response(l(0x18c),{'status':0x194});}}else return await vlessOverWSHandler(s);}catch(B){let Y=B;return new Response(Y[l(0x1bf)]());}}};async function vlessOverWSHandler(s){const m=I,H=new WebSocketPair(),[n,S]=Object[m(0x1a8)](H);S['accept']();let u='',V='';const B=(X,K)=>{const c=m;console[c(0x197)]('['+u+':'+V+']\x20'+X,K||'');},Y=s[m(0x17a)]['get']('sec-websocket-protocol')||'',O=makeReadableWebSocketStream(S,Y,B);let J={'value':null},q=null,d=![];return O['pipeTo'](new WritableStream({async 'write'(X,K){const Q=m;if(d&&q)return q(X);if(J[Q(0x17d)]){const N=J[Q(0x17d)]['writable'][Q(0x179)]();await N['write'](X),N[Q(0x1c5)]();return;}const {hasError:o,message:z,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawDataIndex:g,vlessVersion:vlessVersion=new Uint8Array([0x0,0x0]),isUDP:M}=processVlessHeader(X,userID);u=addressRemote,V=portRemote+'--'+Math['random']()+'\x20'+(M?Q(0x18d):'tcp\x20')+'\x20';if(o){throw new Error(z);return;}if(M){if(portRemote===0x35)d=!![];else{throw new Error(Q(0x1be));return;}}const W=new Uint8Array([vlessVersion[0x0],0x0]),L=X['slice'](g);if(d){const {write:C}=await handleUDPOutBound(S,W,B);q=C,q(L);return;}handleTCPOutBound(J,addressRemote,portRemote,L,S,W,B);},'close'(){const G=m;B(G(0x187));},'abort'(X){const k=m;B(k(0x1c2),JSON[k(0x19e)](X));}}))[m(0x183)](X=>{B('readableWebSocketStream\x20pipeTo\x20error',X);}),new Response(null,{'status':0x65,'webSocket':n});}async function handleTCPOutBound(s,H,n,S,u,V,B){async function Y(q,d){const D=t,X=connect({'hostname':q,'port':d});s['value']=X,B('connected\x20to\x20'+q+':'+d);const K=X[D(0x19d)][D(0x179)]();return await K[D(0x18b)](S),K[D(0x1c5)](),X;}async function O(){const p=t,q=await Y(proxyIP||H,n);q[p(0x1ac)][p(0x183)](d=>{const a=p;console[a(0x197)](a(0x185),d);})[p(0x1bb)](()=>{safeCloseWebSocket(u);}),remoteSocketToWS(q,u,V,null,B);}const J=await Y(H,n);remoteSocketToWS(J,u,V,O,B);}function makeReadableWebSocketStream(s,H,n){let S=![];const u=new ReadableStream({'start'(V){const F=t;s[F(0x1a0)](F(0x189),O=>{const b=F;if(S)return;const J=O[b(0x1a1)];V[b(0x181)](J);}),s['addEventListener']('close',()=>{const E=F;safeCloseWebSocket(s);if(S)return;V[E(0x18a)]();}),s['addEventListener'](F(0x1c9),O=>{const w=F;n('webSocketServer\x20has\x20error'),V[w(0x1c9)](O);});const {earlyData:B,error:Y}=base64ToArrayBuffer(H);if(Y)V[F(0x1c9)](Y);else B&&V[F(0x181)](B);},'pull'(V){},'cancel'(V){const P=t;if(S)return;n(P(0x195)+V),S=!![],safeCloseWebSocket(s);}});return u;}function processVlessHeader(s,H){const e=I;if(s['byteLength']<0x18)return{'hasError':!![],'message':e(0x190)};const n=new Uint8Array(s[e(0x186)](0x0,0x1));let S=![],u=![];stringify(new Uint8Array(s['slice'](0x1,0x11)))===H&&(S=!![]);if(!S)return{'hasError':!![],'message':e(0x1b4)};const V=new Uint8Array(s[e(0x186)](0x11,0x12))[0x0],B=new Uint8Array(s['slice'](0x12+V,0x12+V+0x1))[0x0];if(B===0x1){}else{if(B===0x2)u=!![];else return{'hasError':!![],'message':'command\x20'+B+'\x20is\x20not\x20support,\x20command\x2001-tcp,02-udp,03-mux'};}const Y=0x12+V+0x1,O=s['slice'](Y,Y+0x2),J=new DataView(O)[e(0x17b)](0x0);let q=Y+0x2;const d=new Uint8Array(s[e(0x186)](q,q+0x1)),X=d[0x0];let K=0x0,o=q+0x1,z='';switch(X){case 0x1:K=0x4,z=new Uint8Array(s[e(0x186)](o,o+K))[e(0x199)]('.');break;case 0x2:K=new Uint8Array(s[e(0x186)](o,o+0x1))[0x0],o+=0x1,z=new TextDecoder()['decode'](s[e(0x186)](o,o+K));break;case 0x3:K=0x10;const g=new DataView(s[e(0x186)](o,o+K)),M=[];for(let W=0x0;W<0x8;W++){M[e(0x1b3)](g[e(0x17b)](W*0x2)[e(0x1bf)](0x10));}z=M['join'](':');break;default:return{'hasError':!![],'message':'invild\x20\x20addressType\x20is\x20'+X};}if(!z)return{'hasError':!![],'message':'addressValue\x20is\x20empty,\x20addressType\x20is\x20'+X};return{'hasError':![],'addressRemote':z,'addressType':X,'portRemote':J,'rawDataIndex':o+K,'vlessVersion':n,'isUDP':u};}async function remoteSocketToWS(s,H,n,S,u){const T=I;let V=0x0,B=[],Y=n,O=![];await s[T(0x1ad)][T(0x1a2)](new WritableStream({'start'(){},async 'write'(J,q){const y=T;O=!![],H[y(0x1cd)]!==WS_READY_STATE_OPEN&&q[y(0x1c9)](y(0x17e)),Y?(H['send'](await new Blob([Y,J])['arrayBuffer']()),Y=null):H[y(0x19c)](J);},'close'(){const f=T;u(f(0x1b6)+O);},'abort'(J){const r=T;console['error'](r(0x1c3),J);}}))[T(0x183)](J=>{const v=T;console['error'](v(0x193),J['stack']||J),safeCloseWebSocket(H);}),O===![]&&S&&(u(T(0x1c8)),S());}function base64ToArrayBuffer(s){const h=I;if(!s)return{'error':null};try{s=s[h(0x1b7)](/-/g,'+')[h(0x1b7)](/_/g,'/');const H=atob(s),n=Uint8Array[h(0x1aa)](H,S=>S[h(0x1a5)](0x0));return{'earlyData':n[h(0x1c7)],'error':null};}catch(S){return{'error':S};}}function isValidUUID(s){const H=/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return H['test'](s);}const WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(s){const x=I;try{(s[x(0x1cd)]===WS_READY_STATE_OPEN||s[x(0x1cd)]===WS_READY_STATE_CLOSING)&&s[x(0x18a)]();}catch(H){console[x(0x1c9)](x(0x1ab),H);}}const byteToHex=[];for(let i=0x0;i<0x100;++i){byteToHex[I(0x1b3)]((i+0x100)[I(0x1bf)](0x10)[I(0x186)](0x1));}function unsafeStringify(s,H=0x0){const j=I;return(byteToHex[s[H+0x0]]+byteToHex[s[H+0x1]]+byteToHex[s[H+0x2]]+byteToHex[s[H+0x3]]+'-'+byteToHex[s[H+0x4]]+byteToHex[s[H+0x5]]+'-'+byteToHex[s[H+0x6]]+byteToHex[s[H+0x7]]+'-'+byteToHex[s[H+0x8]]+byteToHex[s[H+0x9]]+'-'+byteToHex[s[H+0xa]]+byteToHex[s[H+0xb]]+byteToHex[s[H+0xc]]+byteToHex[s[H+0xd]]+byteToHex[s[H+0xe]]+byteToHex[s[H+0xf]])[j(0x19f)]();}function A(){const A4=['POST','vless','charCodeAt','pathname','?encryption=none&security=tls&sni=','values','\x0a---------------------------------------------------------------\x0a################################################################\x0aclash-meta\x0a---------------------------------------------------------------\x0a-\x20type:\x20vless\x0a\x20\x20name:\x20','from','safeCloseWebSocket\x20error','closed','readable','2119007ZbmnDj','websocket','\x0a\x20\x20port:\x20443\x0a\x20\x20uuid:\x20','411159lGamvq','4119416MOSaEV','push','invalid\x20user','doh\x20success\x20and\x20dns\x20message\x20length\x20is\x20','remoteConnection!.readable\x20is\x20close\x20with\x20hasIncomingData\x20is\x20','replace','\x0a\x20\x20network:\x20ws\x0a\x20\x20tls:\x20true\x0a\x20\x20udp:\x20false\x0a\x20\x20sni:\x20','Stringified\x20UUID\x20is\x20invalid','216844GGGxQT','finally','byteLength','Upgrade','UDP\x20proxy\x20only\x20enable\x20for\x20DNS\x20which\x20is\x20port\x2053','toString','24EWCdAN','\x0a################################################################\x0av2ray\x0a---------------------------------------------------------------\x0a','readableWebSocketStream\x20is\x20abort','remoteConnection!.readable\x20abort','225JWorGK','releaseLock','1199430USFPXg','buffer','retry','error','24DPdjmJ','https://1.1.1.1/dns-query','42OxvQlI','readyState','2cJTHKj','102858mLwOqt','getWriter','headers','getUint16','Host','value','webSocket.readyState\x20is\x20not\x20open,\x20maybe\x20close','application/dns-message','PROXYIP','enqueue','text/plain;charset=utf-8','catch','\x0a---------------------------------------------------------------\x0a################################################################\x0a','retry\x20tcpSocket\x20closed\x20error','slice','readableWebSocketStream\x20is\x20close',':443','message','close','write','Not\x20found','udp\x20','\x0a\x20\x20client-fingerprint:\x20chrome\x0a\x20\x20ws-opts:\x0a\x20\x20\x20\x20path:\x20\x22/?ed=2048\x22\x0a\x20\x20\x20\x20headers:\x0a\x20\x20\x20\x20\x20\x20host:\x20','arrayBuffer','invalid\x20data','4471540ZOcOgg','d342d11e-d424-4583-b36e-524ab1f0afa4','remoteSocketToWS\x20has\x20exception\x20','\x0a\x20\x20server:\x20','ReadableStream\x20was\x20canceled,\x20due\x20to\x20','get','log','UUID','join','&fp=randomized&type=ws&host=','dns\x20udp\x20has\x20error','send','writable','stringify','toLowerCase','addEventListener','data','pipeTo'];A=function(){return A4;};return A();}function stringify(s,H=0x0){const U=I,n=unsafeStringify(s,H);if(!isValidUUID(n))throw TypeError(U(0x1b9));return n;}async function handleUDPOutBound(s,H,n){const A0=I;let S=![];const u=new TransformStream({'start'(B){},'transform'(B,Y){const Z=t;for(let O=0x0;O<B[Z(0x1bc)];){const J=B['slice'](O,O+0x2),q=new DataView(J)['getUint16'](0x0),d=new Uint8Array(B['slice'](O+0x2,O+0x2+q));O=O+0x2+q,Y['enqueue'](d);}},'flush'(B){}});u[A0(0x1ad)][A0(0x1a2)](new WritableStream({async 'write'(B){const A1=A0,Y=await fetch(A1(0x1cb),{'method':A1(0x1a3),'headers':{'content-type':A1(0x17f)},'body':B}),O=await Y[A1(0x18f)](),J=O['byteLength'],q=new Uint8Array([J>>0x8&0xff,J&0xff]);s[A1(0x1cd)]===WS_READY_STATE_OPEN&&(n(A1(0x1b5)+J),S?s[A1(0x19c)](await new Blob([q,O])['arrayBuffer']()):(s['send'](await new Blob([H,q,O])[A1(0x18f)]()),S=!![]));}}))[A0(0x183)](B=>{const A2=A0;n(A2(0x19b)+B);});const V=u['writable'][A0(0x179)]();return{'write'(B){V['write'](B);}};}function getVLESSConfig(s,H){const A3=I,n=A3(0x1a4),S=''+n+('://'+s+'@'+H+A3(0x188))+(A3(0x1a7)+H+A3(0x19a)+H+'&path=%2F%3Fed%3D2048#'+H);return A3(0x1c1)+S+A3(0x1a9)+H+A3(0x194)+H+A3(0x1b0)+s+A3(0x1b8)+H+A3(0x18e)+H+A3(0x184);}
