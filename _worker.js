const I=S;(function(A,t){const R=S,s=A();while(!![]){try{const H=parseInt(R(0x1d4))/0x1+-parseInt(R(0x1cf))/0x2*(-parseInt(R(0x1bc))/0x3)+parseInt(R(0x1db))/0x4+-parseInt(R(0x1b3))/0x5+-parseInt(R(0x1bd))/0x6*(parseInt(R(0x1c8))/0x7)+-parseInt(R(0x1d2))/0x8*(parseInt(R(0x1d6))/0x9)+-parseInt(R(0x1a4))/0xa;if(H===t)break;else s['push'](s['shift']());}catch(u){s['push'](s['shift']());}}}(n,0x45a07));import{connect}from'cloudflare:sockets';let userID='d342d11e-d424-4583-b36e-524ab1f0afa4',proxyIP='';function n(){const A8=['exception','invild\x20\x20addressType\x20is\x20','send','\x0a---------------------------------------------------------------\x0a################################################################\x0a','Stringified\x20UUID\x20is\x20invalid','UUID','addEventListener','catch','websocket','connected\x20to\x20','safeCloseWebSocket\x20error','readable','ReadableStream\x20was\x20canceled,\x20due\x20to\x20','arrayBuffer','close','tcp\x20','table','url','\x20is\x20not\x20support,\x20command\x2001-tcp,02-udp,03-mux','retry','toString','finally','\x0a\x20\x20port:\x20443\x0a\x20\x20uuid:\x20','\x0a---------------------------------------------------------------\x0a################################################################\x0aclash-meta\x0a---------------------------------------------------------------\x0a-\x20type:\x20vless\x0a\x20\x20name:\x20','return\x20(function()\x20','PROXYIP','writable','replace','https://1.1.1.1/dns-query','error','readyState','&fp=randomized&type=ws&host=','webSocketServer\x20has\x20error','getWriter','console','301010pkrAvp','byteLength','log','invalid\x20data','constructor','text/plain;charset=utf-8','write','sec-websocket-protocol','join','readableWebSocketStream\x20pipeTo\x20error','slice','?encryption=none&security=tls&sni=','info','search','command\x20','81200QXsBUS','get','from','remoteSocketToWS\x20has\x20exception\x20','doh\x20success\x20and\x20dns\x20message\x20length\x20is\x20','\x0a\x20\x20client-fingerprint:\x20chrome\x0a\x20\x20ws-opts:\x0a\x20\x20\x20\x20path:\x20\x22/?ed=2048\x22\x0a\x20\x20\x20\x20headers:\x0a\x20\x20\x20\x20\x20\x20host:\x20','headers','pipeTo','apply','1437KQkKBO','2723898YmRgzV','Not\x20found','(((.+)+)+)+$','vless','udp\x20','message','releaseLock','addressValue\x20is\x20empty,\x20addressType\x20is\x20','values',':443','warn','7DLYqYi','uuid\x20is\x20not\x20valid','remoteConnection!.readable\x20abort','test','remoteConnection!.readable\x20is\x20close\x20with\x20hasIncomingData\x20is\x20','push','{}.constructor(\x22return\x20this\x22)(\x20)','1366BqmTRp','trace','stack','8kKedCw','&path=%2F%3Fed%3D2048#','548162KTWCuo','random','4328253BTNAod','\x0a################################################################\x0av2ray\x0a---------------------------------------------------------------\x0a','enqueue','stringify','://','1564452jSdWep','POST','bind','getUint16'];n=function(){return A8;};return n();}if(!isValidUUID(userID))throw new Error(I(0x1c9));export default{async 'fetch'(A,t,s){const l=I;try{userID=t[l(0x1e4)]||userID,proxyIP=t[l(0x19a)]||proxyIP;const H=A[l(0x1b9)][l(0x1b4)]('Upgrade');if(!H||H!==l(0x1e7)){const u=new URL(A[l(0x192)]);switch(u['pathname']){case'/':return new Response(JSON['stringify'](A['cf']),{'status':0xc8});case'/'+userID:{const V=getVLESSConfig(userID,A['headers'][l(0x1b4)]('Host'));return new Response(''+V,{'status':0xc8,'headers':{'Content-Type':l(0x1a9)}});}default:return new Response(l(0x1be),{'status':0x194});}}else return await vlessOverWSHandler(A);}catch(B){let Y=B;return new Response(Y['toString']());}}};async function vlessOverWSHandler(A){const m=I,t=new WebSocketPair(),[s,H]=Object[m(0x1c5)](t);H['accept']();let u='',V='';const B=(X,K)=>{const c=m;console[c(0x1a6)]('['+u+':'+V+']\x20'+X,K||'');},Y=A['headers'][m(0x1b4)](m(0x1ab))||'',O=makeReadableWebSocketStream(H,Y,B);let J={'value':null},q=null,d=![];return O[m(0x1ba)](new WritableStream({async 'write'(X,K){const Q=m;if(d&&q)return q(X);if(J['value']){const N=J['value'][Q(0x19b)]['getWriter']();await N[Q(0x1aa)](X),N[Q(0x1c3)]();return;}const {hasError:o,message:z,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawDataIndex:g,vlessVersion:vlessVersion=new Uint8Array([0x0,0x0]),isUDP:M}=processVlessHeader(X,userID);u=addressRemote,V=portRemote+'--'+Math[Q(0x1d5)]()+'\x20'+(M?Q(0x1c1):Q(0x1ee))+'\x20';if(o){throw new Error(z);return;}if(M){if(portRemote===0x35)d=!![];else{throw new Error('UDP\x20proxy\x20only\x20enable\x20for\x20DNS\x20which\x20is\x20port\x2053');return;}}const W=new Uint8Array([vlessVersion[0x0],0x0]),L=X['slice'](g);if(d){const {write:C}=await handleUDPOutBound(H,W,B);q=C,q(L);return;}handleTCPOutBound(J,addressRemote,portRemote,L,H,W,B);},'close'(){B('readableWebSocketStream\x20is\x20close');},'abort'(X){const G=m;B('readableWebSocketStream\x20is\x20abort',JSON[G(0x1d9)](X));}}))[m(0x1e6)](X=>{const k=m;B(k(0x1ad),X);}),new Response(null,{'status':0x65,'webSocket':s});}async function handleTCPOutBound(A,t,s,H,u,V,B){async function Y(q,d){const D=S,X=connect({'hostname':q,'port':d});A['value']=X,B(D(0x1e8)+q+':'+d);const K=X['writable'][D(0x1a2)]();return await K['write'](H),K['releaseLock'](),X;}async function O(){const p=S,q=await Y(proxyIP||t,s);q['closed'][p(0x1e6)](d=>{const a=p;console[a(0x1a6)]('retry\x20tcpSocket\x20closed\x20error',d);})[p(0x196)](()=>{safeCloseWebSocket(u);}),remoteSocketToWS(q,u,V,null,B);}const J=await Y(t,s);remoteSocketToWS(J,u,V,O,B);}function makeReadableWebSocketStream(A,t,s){let H=![];const u=new ReadableStream({'start'(V){const F=S;A[F(0x1e5)](F(0x1c2),O=>{const b=F;if(H)return;const J=O['data'];V[b(0x1d8)](J);}),A['addEventListener'](F(0x1ed),()=>{safeCloseWebSocket(A);if(H)return;V['close']();}),A[F(0x1e5)]('error',O=>{const E=F;s(E(0x1a1)),V[E(0x19e)](O);});const {earlyData:B,error:Y}=base64ToArrayBuffer(t);if(Y)V[F(0x19e)](Y);else B&&V[F(0x1d8)](B);},'pull'(V){},'cancel'(V){const w=S;if(H)return;s(w(0x1eb)+V),H=!![],safeCloseWebSocket(A);}});return u;}function processVlessHeader(A,t){const P=I;if(A[P(0x1a5)]<0x18)return{'hasError':!![],'message':P(0x1a7)};const s=new Uint8Array(A['slice'](0x0,0x1));let H=![],u=![];stringify(new Uint8Array(A[P(0x1ae)](0x1,0x11)))===t&&(H=!![]);if(!H)return{'hasError':!![],'message':'invalid\x20user'};const V=new Uint8Array(A[P(0x1ae)](0x11,0x12))[0x0],B=new Uint8Array(A['slice'](0x12+V,0x12+V+0x1))[0x0];if(B===0x1){}else{if(B===0x2)u=!![];else return{'hasError':!![],'message':P(0x1b2)+B+P(0x193)};}const Y=0x12+V+0x1,O=A[P(0x1ae)](Y,Y+0x2),J=new DataView(O)[P(0x1de)](0x0);let q=Y+0x2;const d=new Uint8Array(A[P(0x1ae)](q,q+0x1)),X=d[0x0];let K=0x0,o=q+0x1,z='';switch(X){case 0x1:K=0x4,z=new Uint8Array(A['slice'](o,o+K))[P(0x1ac)]('.');break;case 0x2:K=new Uint8Array(A[P(0x1ae)](o,o+0x1))[0x0],o+=0x1,z=new TextDecoder()['decode'](A[P(0x1ae)](o,o+K));break;case 0x3:K=0x10;const g=new DataView(A[P(0x1ae)](o,o+K)),M=[];for(let W=0x0;W<0x8;W++){M[P(0x1cd)](g[P(0x1de)](W*0x2)['toString'](0x10));}z=M[P(0x1ac)](':');break;default:return{'hasError':!![],'message':P(0x1e0)+X};}if(!z)return{'hasError':!![],'message':P(0x1c4)+X};return{'hasError':![],'addressRemote':z,'addressType':X,'portRemote':J,'rawDataIndex':o+K,'vlessVersion':s,'isUDP':u};}async function remoteSocketToWS(A,t,s,H,u){const e=I;let V=0x0,B=[],Y=s,O=![];await A[e(0x1ea)]['pipeTo'](new WritableStream({'start'(){},async 'write'(J,q){const T=e;O=!![],t['readyState']!==WS_READY_STATE_OPEN&&q[T(0x19e)]('webSocket.readyState\x20is\x20not\x20open,\x20maybe\x20close'),Y?(t['send'](await new Blob([Y,J])[T(0x1ec)]()),Y=null):t[T(0x1e1)](J);},'close'(){const y=e;u(y(0x1cc)+O);},'abort'(J){const f=e;console[f(0x19e)](f(0x1ca),J);}}))[e(0x1e6)](J=>{const r=e;console[r(0x19e)](r(0x1b6),J[r(0x1d1)]||J),safeCloseWebSocket(t);}),O===![]&&H&&(u(e(0x194)),H());}function base64ToArrayBuffer(A){const v=I;if(!A)return{'error':null};try{A=A[v(0x19c)](/-/g,'+')[v(0x19c)](/_/g,'/');const t=atob(A),s=Uint8Array[v(0x1b5)](t,H=>H['charCodeAt'](0x0));return{'earlyData':s['buffer'],'error':null};}catch(H){return{'error':H};}}function isValidUUID(u){const A0=I,V=(function(){let q=!![];return function(d,X){const K=q?function(){const h=S;if(X){const o=X[h(0x1bb)](d,arguments);return X=null,o;}}:function(){};return q=![],K;};}()),B=V(this,function(){const x=S;return B['toString']()['search'](x(0x1bf))['toString']()[x(0x1a8)](B)[x(0x1b1)](x(0x1bf));});B();const Y=(function(){let q=!![];return function(d,X){const K=q?function(){const j=S;if(X){const o=X[j(0x1bb)](d,arguments);return X=null,o;}}:function(){};return q=![],K;};}()),O=Y(this,function(){const Z=S,q=function(){const U=S;let o;try{o=Function(U(0x199)+U(0x1ce)+');')();}catch(z){o=window;}return o;},d=q(),X=d[Z(0x1a3)]=d[Z(0x1a3)]||{},K=[Z(0x1a6),Z(0x1c7),Z(0x1b0),'error',Z(0x1df),Z(0x191),Z(0x1d0)];for(let o=0x0;o<K['length'];o++){const z=Y['constructor']['prototype'][Z(0x1dd)](Y),g=K[o],M=X[g]||z;z['__proto__']=Y[Z(0x1dd)](Y),z[Z(0x195)]=M[Z(0x195)][Z(0x1dd)](M),X[g]=z;}});O();const J=/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return J[A0(0x1cb)](u);}const WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(A){const A1=I;try{(A[A1(0x19f)]===WS_READY_STATE_OPEN||A[A1(0x19f)]===WS_READY_STATE_CLOSING)&&A[A1(0x1ed)]();}catch(t){console['error'](A1(0x1e9),t);}}const byteToHex=[];for(let i=0x0;i<0x100;++i){byteToHex['push']((i+0x100)[I(0x195)](0x10)[I(0x1ae)](0x1));}function unsafeStringify(A,t=0x0){return(byteToHex[A[t+0x0]]+byteToHex[A[t+0x1]]+byteToHex[A[t+0x2]]+byteToHex[A[t+0x3]]+'-'+byteToHex[A[t+0x4]]+byteToHex[A[t+0x5]]+'-'+byteToHex[A[t+0x6]]+byteToHex[A[t+0x7]]+'-'+byteToHex[A[t+0x8]]+byteToHex[A[t+0x9]]+'-'+byteToHex[A[t+0xa]]+byteToHex[A[t+0xb]]+byteToHex[A[t+0xc]]+byteToHex[A[t+0xd]]+byteToHex[A[t+0xe]]+byteToHex[A[t+0xf]])['toLowerCase']();}function S(A,t){const s=n();return S=function(H,u){H=H-0x191;let V=s[H];return V;},S(A,t);}function stringify(A,t=0x0){const A2=I,s=unsafeStringify(A,t);if(!isValidUUID(s))throw TypeError(A2(0x1e3));return s;}async function handleUDPOutBound(A,t,s){const A4=I;let H=![];const u=new TransformStream({'start'(B){},'transform'(B,Y){const A3=S;for(let O=0x0;O<B['byteLength'];){const J=B[A3(0x1ae)](O,O+0x2),q=new DataView(J)['getUint16'](0x0),d=new Uint8Array(B['slice'](O+0x2,O+0x2+q));O=O+0x2+q,Y[A3(0x1d8)](d);}},'flush'(B){}});u[A4(0x1ea)][A4(0x1ba)](new WritableStream({async 'write'(B){const A5=A4,Y=await fetch(A5(0x19d),{'method':A5(0x1dc),'headers':{'content-type':'application/dns-message'},'body':B}),O=await Y[A5(0x1ec)](),J=O[A5(0x1a5)],q=new Uint8Array([J>>0x8&0xff,J&0xff]);A[A5(0x19f)]===WS_READY_STATE_OPEN&&(s(A5(0x1b7)+J),H?A[A5(0x1e1)](await new Blob([q,O])[A5(0x1ec)]()):(A[A5(0x1e1)](await new Blob([t,q,O])[A5(0x1ec)]()),H=!![]));}}))[A4(0x1e6)](B=>{s('dns\x20udp\x20has\x20error'+B);});const V=u['writable'][A4(0x1a2)]();return{'write'(B){const A6=A4;V[A6(0x1aa)](B);}};}function getVLESSConfig(A,t){const A7=I,s=A7(0x1c0),H=''+s+(A7(0x1da)+A+'@'+t+A7(0x1c6))+(A7(0x1af)+t+A7(0x1a0)+t+A7(0x1d3)+t);return A7(0x1d7)+H+A7(0x198)+t+'\x0a\x20\x20server:\x20'+t+A7(0x197)+A+'\x0a\x20\x20network:\x20ws\x0a\x20\x20tls:\x20true\x0a\x20\x20udp:\x20false\x0a\x20\x20sni:\x20'+t+A7(0x1b8)+t+A7(0x1e2);}
