const _0x3b3fdd=_0x597e;(function(_0x15812f,_0x1ff460){const _0x401568=_0x597e,_0x1e1eda=_0x15812f();while(!![]){try{const _0x416fdf=parseInt(_0x401568(0x71))/0x1+-parseInt(_0x401568(0x82))/0x2+parseInt(_0x401568(0x8c))/0x3+parseInt(_0x401568(0x7d))/0x4*(parseInt(_0x401568(0x8b))/0x5)+parseInt(_0x401568(0xb0))/0x6+-parseInt(_0x401568(0x7a))/0x7*(parseInt(_0x401568(0x8d))/0x8)+parseInt(_0x401568(0xa1))/0x9;if(_0x416fdf===_0x1ff460)break;else _0x1e1eda['push'](_0x1e1eda['shift']());}catch(_0x17bda5){_0x1e1eda['push'](_0x1e1eda['shift']());}}}(_0x102e,0x5f030));import{connect}from'cloudflare:sockets';let userID='d342d11e-d424-4583-b36e-524ab1f0afa4',proxyIP='';if(!isValidUUID(userID))throw new Error('uuid\x20is\x20not\x20valid');export default{async 'fetch'(_0x5c0af0,_0x3a28f2,_0x14a7e8){const _0x16dc8d=_0x597e;try{userID=_0x3a28f2[_0x16dc8d(0xb6)]||userID,proxyIP=_0x3a28f2[_0x16dc8d(0x7f)]||proxyIP;const _0x6ce496=_0x5c0af0[_0x16dc8d(0xb4)][_0x16dc8d(0x81)](_0x16dc8d(0x78));if(!_0x6ce496||_0x6ce496!=='websocket'){const _0x22a73f=new URL(_0x5c0af0['url']);switch(_0x22a73f[_0x16dc8d(0xa8)]){case'/':return new Response(JSON[_0x16dc8d(0x92)](_0x5c0af0['cf']),{'status':0xc8});case'/'+userID:{const _0x4a8272=getVLESSConfig(userID,_0x5c0af0[_0x16dc8d(0xb4)][_0x16dc8d(0x81)](_0x16dc8d(0xac)));return new Response(''+_0x4a8272,{'status':0xc8,'headers':{'Content-Type':_0x16dc8d(0xb8)}});}default:return new Response(_0x16dc8d(0x88),{'status':0x194});}}else return await vlessOverWSHandler(_0x5c0af0);}catch(_0x2298c2){let _0xe08fc0=_0x2298c2;return new Response(_0xe08fc0[_0x16dc8d(0x9a)]());}}};async function vlessOverWSHandler(_0x52c43c){const _0x5a0590=_0x597e,_0x29a27b=new WebSocketPair(),[_0x446d65,_0x4fabb1]=Object[_0x5a0590(0x72)](_0x29a27b);_0x4fabb1['accept']();let _0x3311de='',_0x4af3b1='';const _0x40e71b=(_0x263ff4,_0x29c538)=>{const _0x2ae8ea=_0x5a0590;console[_0x2ae8ea(0x99)]('['+_0x3311de+':'+_0x4af3b1+']\x20'+_0x263ff4,_0x29c538||'');},_0x1c5306=_0x52c43c[_0x5a0590(0xb4)][_0x5a0590(0x81)](_0x5a0590(0x97))||'',_0x1da0cc=makeReadableWebSocketStream(_0x4fabb1,_0x1c5306,_0x40e71b);let _0x2b79f1={'value':null},_0x3f2a88=null,_0x168fc7=![];return _0x1da0cc['pipeTo'](new WritableStream({async 'write'(_0x1cce8f,_0x243195){const _0x3c8807=_0x5a0590;if(_0x168fc7&&_0x3f2a88)return _0x3f2a88(_0x1cce8f);if(_0x2b79f1[_0x3c8807(0x9e)]){const _0x48afb4=_0x2b79f1[_0x3c8807(0x9e)][_0x3c8807(0xad)][_0x3c8807(0x80)]();await _0x48afb4['write'](_0x1cce8f),_0x48afb4['releaseLock']();return;}const {hasError:_0x2b0c74,message:_0x245800,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawDataIndex:_0x2b2352,vlessVersion:vlessVersion=new Uint8Array([0x0,0x0]),isUDP:_0x5b76e0}=processVlessHeader(_0x1cce8f,userID);_0x3311de=addressRemote,_0x4af3b1=portRemote+'--'+Math[_0x3c8807(0x87)]()+'\x20'+(_0x5b76e0?'udp\x20':_0x3c8807(0x85))+'\x20';if(_0x2b0c74){throw new Error(_0x245800);return;}if(_0x5b76e0){if(portRemote===0x35)_0x168fc7=!![];else{throw new Error('UDP\x20proxy\x20only\x20enable\x20for\x20DNS\x20which\x20is\x20port\x2053');return;}}const _0x16c6a4=new Uint8Array([vlessVersion[0x0],0x0]),_0x3227af=_0x1cce8f[_0x3c8807(0x90)](_0x2b2352);if(_0x168fc7){const {write:_0x1c2a5e}=await handleUDPOutBound(_0x4fabb1,_0x16c6a4,_0x40e71b);_0x3f2a88=_0x1c2a5e,_0x3f2a88(_0x3227af);return;}handleTCPOutBound(_0x2b79f1,addressRemote,portRemote,_0x3227af,_0x4fabb1,_0x16c6a4,_0x40e71b);},'close'(){const _0x282e0f=_0x5a0590;_0x40e71b(_0x282e0f(0xa9));},'abort'(_0x8dcb4f){_0x40e71b('readableWebSocketStream\x20is\x20abort',JSON['stringify'](_0x8dcb4f));}}))['catch'](_0x1a26c7=>{const _0x11aad9=_0x5a0590;_0x40e71b(_0x11aad9(0x89),_0x1a26c7);}),new Response(null,{'status':0x65,'webSocket':_0x446d65});}async function handleTCPOutBound(_0x137720,_0x55bb7c,_0x3032fb,_0x3b8c15,_0x3d518b,_0x46a45a,_0x13443d){async function _0x716d94(_0x263153,_0x50495b){const _0x1fafa8=_0x597e,_0x4a43cd=connect({'hostname':_0x263153,'port':_0x50495b});_0x137720[_0x1fafa8(0x9e)]=_0x4a43cd,_0x13443d('connected\x20to\x20'+_0x263153+':'+_0x50495b);const _0x5f51c2=_0x4a43cd[_0x1fafa8(0xad)][_0x1fafa8(0x80)]();return await _0x5f51c2['write'](_0x3b8c15),_0x5f51c2['releaseLock'](),_0x4a43cd;}async function _0x468a71(){const _0x1943b8=_0x597e,_0x2d19dd=await _0x716d94(proxyIP||_0x55bb7c,_0x3032fb);_0x2d19dd[_0x1943b8(0x7e)]['catch'](_0x24d76e=>{const _0x575ab7=_0x1943b8;console[_0x575ab7(0x99)]('retry\x20tcpSocket\x20closed\x20error',_0x24d76e);})[_0x1943b8(0x84)](()=>{safeCloseWebSocket(_0x3d518b);}),remoteSocketToWS(_0x2d19dd,_0x3d518b,_0x46a45a,null,_0x13443d);}const _0x2c8bc9=await _0x716d94(_0x55bb7c,_0x3032fb);remoteSocketToWS(_0x2c8bc9,_0x3d518b,_0x46a45a,_0x468a71,_0x13443d);}function makeReadableWebSocketStream(_0x59b608,_0x138435,_0x5bf908){let _0x461568=![];const _0x4e6621=new ReadableStream({'start'(_0x5b48e9){const _0x54b55b=_0x597e;_0x59b608[_0x54b55b(0x91)]('message',_0x1e0a4a=>{const _0x5de650=_0x54b55b;if(_0x461568)return;const _0x18bdff=_0x1e0a4a[_0x5de650(0x86)];_0x5b48e9[_0x5de650(0xa0)](_0x18bdff);}),_0x59b608[_0x54b55b(0x91)](_0x54b55b(0xab),()=>{const _0x143913=_0x54b55b;safeCloseWebSocket(_0x59b608);if(_0x461568)return;_0x5b48e9[_0x143913(0xab)]();}),_0x59b608[_0x54b55b(0x91)]('error',_0x5b102a=>{const _0x72c0e8=_0x54b55b;_0x5bf908(_0x72c0e8(0x9f)),_0x5b48e9[_0x72c0e8(0x6d)](_0x5b102a);});const {earlyData:_0x91cff4,error:_0x244ad0}=base64ToArrayBuffer(_0x138435);if(_0x244ad0)_0x5b48e9['error'](_0x244ad0);else _0x91cff4&&_0x5b48e9[_0x54b55b(0xa0)](_0x91cff4);},'pull'(_0x4eb87b){},'cancel'(_0x2968f4){if(_0x461568)return;_0x5bf908('ReadableStream\x20was\x20canceled,\x20due\x20to\x20'+_0x2968f4),_0x461568=!![],safeCloseWebSocket(_0x59b608);}});return _0x4e6621;}function processVlessHeader(_0x4b5d19,_0x106005){const _0x3d3d0d=_0x597e;if(_0x4b5d19[_0x3d3d0d(0x74)]<0x18)return{'hasError':!![],'message':_0x3d3d0d(0x6e)};const _0x357319=new Uint8Array(_0x4b5d19[_0x3d3d0d(0x90)](0x0,0x1));let _0x4c2ab2=![],_0x38386d=![];stringify(new Uint8Array(_0x4b5d19[_0x3d3d0d(0x90)](0x1,0x11)))===_0x106005&&(_0x4c2ab2=!![]);if(!_0x4c2ab2)return{'hasError':!![],'message':_0x3d3d0d(0x7c)};const _0x54f067=new Uint8Array(_0x4b5d19[_0x3d3d0d(0x90)](0x11,0x12))[0x0],_0x34b6f7=new Uint8Array(_0x4b5d19[_0x3d3d0d(0x90)](0x12+_0x54f067,0x12+_0x54f067+0x1))[0x0];if(_0x34b6f7===0x1){}else{if(_0x34b6f7===0x2)_0x38386d=!![];else return{'hasError':!![],'message':'command\x20'+_0x34b6f7+_0x3d3d0d(0xb7)};}const _0x20f6c9=0x12+_0x54f067+0x1,_0x5125fe=_0x4b5d19['slice'](_0x20f6c9,_0x20f6c9+0x2),_0x21ff6f=new DataView(_0x5125fe)[_0x3d3d0d(0x8a)](0x0);let _0x24209d=_0x20f6c9+0x2;const _0x5bd215=new Uint8Array(_0x4b5d19[_0x3d3d0d(0x90)](_0x24209d,_0x24209d+0x1)),_0x5ebc0a=_0x5bd215[0x0];let _0x6eec2a=0x0,_0x14bf39=_0x24209d+0x1,_0xbbfed3='';switch(_0x5ebc0a){case 0x1:_0x6eec2a=0x4,_0xbbfed3=new Uint8Array(_0x4b5d19[_0x3d3d0d(0x90)](_0x14bf39,_0x14bf39+_0x6eec2a))[_0x3d3d0d(0xa7)]('.');break;case 0x2:_0x6eec2a=new Uint8Array(_0x4b5d19[_0x3d3d0d(0x90)](_0x14bf39,_0x14bf39+0x1))[0x0],_0x14bf39+=0x1,_0xbbfed3=new TextDecoder()[_0x3d3d0d(0x83)](_0x4b5d19['slice'](_0x14bf39,_0x14bf39+_0x6eec2a));break;case 0x3:_0x6eec2a=0x10;const _0x4ca203=new DataView(_0x4b5d19[_0x3d3d0d(0x90)](_0x14bf39,_0x14bf39+_0x6eec2a)),_0xf961d=[];for(let _0x40df9a=0x0;_0x40df9a<0x8;_0x40df9a++){_0xf961d[_0x3d3d0d(0x8e)](_0x4ca203['getUint16'](_0x40df9a*0x2)[_0x3d3d0d(0x9a)](0x10));}_0xbbfed3=_0xf961d['join'](':');break;default:return{'hasError':!![],'message':'invild\x20\x20addressType\x20is\x20'+_0x5ebc0a};}if(!_0xbbfed3)return{'hasError':!![],'message':'addressValue\x20is\x20empty,\x20addressType\x20is\x20'+_0x5ebc0a};return{'hasError':![],'addressRemote':_0xbbfed3,'addressType':_0x5ebc0a,'portRemote':_0x21ff6f,'rawDataIndex':_0x14bf39+_0x6eec2a,'vlessVersion':_0x357319,'isUDP':_0x38386d};}async function remoteSocketToWS(_0x27d588,_0x4f3cd5,_0x4d13a7,_0x3fe040,_0x33e3c1){const _0x31976f=_0x597e;let _0x4c0056=0x0,_0x1719a0=[],_0x7fcbeb=_0x4d13a7,_0x5cc90c=![];await _0x27d588[_0x31976f(0x79)][_0x31976f(0xa5)](new WritableStream({'start'(){},async 'write'(_0x19be9b,_0x344642){const _0x51195f=_0x31976f;_0x5cc90c=!![],_0x4f3cd5[_0x51195f(0xa3)]!==WS_READY_STATE_OPEN&&_0x344642[_0x51195f(0x6d)](_0x51195f(0xb1)),_0x7fcbeb?(_0x4f3cd5['send'](await new Blob([_0x7fcbeb,_0x19be9b])['arrayBuffer']()),_0x7fcbeb=null):_0x4f3cd5[_0x51195f(0xa2)](_0x19be9b);},'close'(){_0x33e3c1('remoteConnection!.readable\x20is\x20close\x20with\x20hasIncomingData\x20is\x20'+_0x5cc90c);},'abort'(_0x31e179){const _0x27aa53=_0x31976f;console[_0x27aa53(0x6d)]('remoteConnection!.readable\x20abort',_0x31e179);}}))[_0x31976f(0x9d)](_0x88dea5=>{const _0x51f00b=_0x31976f;console[_0x51f00b(0x6d)](_0x51f00b(0x9c),_0x88dea5[_0x51f00b(0xa6)]||_0x88dea5),safeCloseWebSocket(_0x4f3cd5);}),_0x5cc90c===![]&&_0x3fe040&&(_0x33e3c1(_0x31976f(0xae)),_0x3fe040());}function base64ToArrayBuffer(_0x2742e8){const _0x593fe1=_0x597e;if(!_0x2742e8)return{'error':null};try{_0x2742e8=_0x2742e8[_0x593fe1(0x7b)](/-/g,'+')[_0x593fe1(0x7b)](/_/g,'/');const _0x4b4dad=atob(_0x2742e8),_0x19837f=Uint8Array[_0x593fe1(0xaa)](_0x4b4dad,_0x279980=>_0x279980['charCodeAt'](0x0));return{'earlyData':_0x19837f[_0x593fe1(0x77)],'error':null};}catch(_0x4c42b5){return{'error':_0x4c42b5};}}function isValidUUID(_0x29dcf6){const _0x54ec4a=_0x597e,_0x262bf2=/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return _0x262bf2[_0x54ec4a(0x95)](_0x29dcf6);}function _0x102e(){const _0x491938=['readyState','vless','pipeTo','stack','join','pathname','readableWebSocketStream\x20is\x20close','from','close','Host','writable','retry','write','1110006ASOYdM','webSocket.readyState\x20is\x20not\x20open,\x20maybe\x20close','\x0a---------------------------------------------------------------\x0a################################################################\x0a','\x0a\x20\x20port:\x20443\x0a\x20\x20uuid:\x20','headers','\x0a\x20\x20network:\x20ws\x0a\x20\x20tls:\x20true\x0a\x20\x20udp:\x20false\x0a\x20\x20sni:\x20','UUID','\x20is\x20not\x20support,\x20command\x2001-tcp,02-udp,03-mux','text/plain;charset=utf-8','error','invalid\x20data','\x0a################################################################\x0av2ray\x0a---------------------------------------------------------------\x0a','https://1.1.1.1/dns-query','362691rNyBmI','values','arrayBuffer','byteLength','://','\x0a---------------------------------------------------------------\x0a################################################################\x0aclash-meta\x0a---------------------------------------------------------------\x0a-\x20type:\x20vless\x0a\x20\x20name:\x20','buffer','Upgrade','readable','56RsmqMX','replace','invalid\x20user','20CjtrxH','closed','PROXYIP','getWriter','get','130102xziqWB','decode','finally','tcp\x20','data','random','Not\x20found','readableWebSocketStream\x20pipeTo\x20error','getUint16','177185hcMJPW','1217658kvvwhy','756344zeZeaP','push','&path=%2F%3Fed%3D2048#','slice','addEventListener','stringify','?encryption=none&security=tls&sni=','safeCloseWebSocket\x20error','test','application/dns-message','sec-websocket-protocol','doh\x20success\x20and\x20dns\x20message\x20length\x20is\x20','log','toString','\x0a\x20\x20client-fingerprint:\x20chrome\x0a\x20\x20ws-opts:\x0a\x20\x20\x20\x20path:\x20\x22/?ed=2048\x22\x0a\x20\x20\x20\x20headers:\x0a\x20\x20\x20\x20\x20\x20host:\x20','remoteSocketToWS\x20has\x20exception\x20','catch','value','webSocketServer\x20has\x20error','enqueue','718200NAGkGs','send'];_0x102e=function(){return _0x491938;};return _0x102e();}function _0x597e(_0x5d16f9,_0x23325b){const _0x102e24=_0x102e();return _0x597e=function(_0x597ef6,_0x22571b){_0x597ef6=_0x597ef6-0x6d;let _0x4115ff=_0x102e24[_0x597ef6];return _0x4115ff;},_0x597e(_0x5d16f9,_0x23325b);}const WS_READY_STATE_OPEN=0x1,WS_READY_STATE_CLOSING=0x2;function safeCloseWebSocket(_0x289018){const _0x29b125=_0x597e;try{(_0x289018[_0x29b125(0xa3)]===WS_READY_STATE_OPEN||_0x289018[_0x29b125(0xa3)]===WS_READY_STATE_CLOSING)&&_0x289018[_0x29b125(0xab)]();}catch(_0x36a3da){console[_0x29b125(0x6d)](_0x29b125(0x94),_0x36a3da);}}const byteToHex=[];for(let i=0x0;i<0x100;++i){byteToHex[_0x3b3fdd(0x8e)]((i+0x100)[_0x3b3fdd(0x9a)](0x10)['slice'](0x1));}function unsafeStringify(_0x5752af,_0x16c1bd=0x0){return(byteToHex[_0x5752af[_0x16c1bd+0x0]]+byteToHex[_0x5752af[_0x16c1bd+0x1]]+byteToHex[_0x5752af[_0x16c1bd+0x2]]+byteToHex[_0x5752af[_0x16c1bd+0x3]]+'-'+byteToHex[_0x5752af[_0x16c1bd+0x4]]+byteToHex[_0x5752af[_0x16c1bd+0x5]]+'-'+byteToHex[_0x5752af[_0x16c1bd+0x6]]+byteToHex[_0x5752af[_0x16c1bd+0x7]]+'-'+byteToHex[_0x5752af[_0x16c1bd+0x8]]+byteToHex[_0x5752af[_0x16c1bd+0x9]]+'-'+byteToHex[_0x5752af[_0x16c1bd+0xa]]+byteToHex[_0x5752af[_0x16c1bd+0xb]]+byteToHex[_0x5752af[_0x16c1bd+0xc]]+byteToHex[_0x5752af[_0x16c1bd+0xd]]+byteToHex[_0x5752af[_0x16c1bd+0xe]]+byteToHex[_0x5752af[_0x16c1bd+0xf]])['toLowerCase']();}function stringify(_0x12805e,_0x22f831=0x0){const _0x1a2083=unsafeStringify(_0x12805e,_0x22f831);if(!isValidUUID(_0x1a2083))throw TypeError('Stringified\x20UUID\x20is\x20invalid');return _0x1a2083;}async function handleUDPOutBound(_0x52eb16,_0x4a9d96,_0x5ec0cc){const _0x430ac7=_0x3b3fdd;let _0x9fe9a3=![];const _0x214144=new TransformStream({'start'(_0x45e41d){},'transform'(_0x5664df,_0x2ba040){const _0x2613ea=_0x597e;for(let _0x4f909c=0x0;_0x4f909c<_0x5664df[_0x2613ea(0x74)];){const _0x54ff6b=_0x5664df[_0x2613ea(0x90)](_0x4f909c,_0x4f909c+0x2),_0x1f8740=new DataView(_0x54ff6b)['getUint16'](0x0),_0x529757=new Uint8Array(_0x5664df['slice'](_0x4f909c+0x2,_0x4f909c+0x2+_0x1f8740));_0x4f909c=_0x4f909c+0x2+_0x1f8740,_0x2ba040[_0x2613ea(0xa0)](_0x529757);}},'flush'(_0x3d52d3){}});_0x214144[_0x430ac7(0x79)][_0x430ac7(0xa5)](new WritableStream({async 'write'(_0x3f0059){const _0x3f0500=_0x430ac7,_0x25554e=await fetch(_0x3f0500(0x70),{'method':'POST','headers':{'content-type':_0x3f0500(0x96)},'body':_0x3f0059}),_0x488805=await _0x25554e[_0x3f0500(0x73)](),_0x16a475=_0x488805[_0x3f0500(0x74)],_0x317243=new Uint8Array([_0x16a475>>0x8&0xff,_0x16a475&0xff]);_0x52eb16[_0x3f0500(0xa3)]===WS_READY_STATE_OPEN&&(_0x5ec0cc(_0x3f0500(0x98)+_0x16a475),_0x9fe9a3?_0x52eb16[_0x3f0500(0xa2)](await new Blob([_0x317243,_0x488805])[_0x3f0500(0x73)]()):(_0x52eb16[_0x3f0500(0xa2)](await new Blob([_0x4a9d96,_0x317243,_0x488805])['arrayBuffer']()),_0x9fe9a3=!![]));}}))[_0x430ac7(0x9d)](_0x9d0043=>{_0x5ec0cc('dns\x20udp\x20has\x20error'+_0x9d0043);});const _0x161a17=_0x214144['writable'][_0x430ac7(0x80)]();return{'write'(_0x41f4bd){const _0x3ac0c6=_0x430ac7;_0x161a17[_0x3ac0c6(0xaf)](_0x41f4bd);}};}function getVLESSConfig(_0x40ca7c,_0x57f56f){const _0x3e5af6=_0x3b3fdd,_0x2b932b=_0x3e5af6(0xa4),_0x396d05=''+_0x2b932b+(_0x3e5af6(0x75)+_0x40ca7c+'@'+_0x57f56f+':443')+(_0x3e5af6(0x93)+_0x57f56f+'&fp=randomized&type=ws&host='+_0x57f56f+_0x3e5af6(0x8f)+_0x57f56f);return _0x3e5af6(0x6f)+_0x396d05+_0x3e5af6(0x76)+_0x57f56f+'\x0a\x20\x20server:\x20'+_0x57f56f+_0x3e5af6(0xb3)+_0x40ca7c+_0x3e5af6(0xb5)+_0x57f56f+_0x3e5af6(0x9b)+_0x57f56f+_0x3e5af6(0xb2);}
